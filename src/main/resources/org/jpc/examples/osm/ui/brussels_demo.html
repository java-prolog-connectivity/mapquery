<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>

	<style type="text/css">
	<!--

	body {
		/*
		background: #CAE1FF;
		*/
		background: #CFE6FF;
		font: 1em Helvetica, Verdana, Arial, sans-serif;
		line-height: 1.3em;
		font-size: 15px;
	}
	
	h1, h2, h3 {
		line-height: 1.1;
		margin: 0.3em 0;
		font-weight: 700;
	}

	h1 {
		letter-spacing: -2px;
		font-size: 2.8em;
		color: #444444;
	}

	h2 {
		font-size: 2.1em;
		color: #222222;
	}

	h3 {
		font-size: 1.5em;
		color: #111111;
	}
	
	.help {
		/*background: #DBDBDB;*/
		text-align: left;
		cursor: pointer;
		margin: 20px auto;
	}
	
	.help-content {
		display: none;
	}

	.query-option{
		
	}
	
	-->
	</style>
	
	
	
	
	<meta charset='utf-8' />
	<title>Logic Maps</title>
	<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
	<script type="text/javascript" src="js/jquery-1.5.1.min.js"></script>
	<script type='text/javascript' src='js/OpenLayers-2.12/OpenLayers.js'></script>
	<script type='text/javascript'>
	
	var g_disableQueryOptions;
	var g_enableQueryOptions;
	
	(function ($) {
		var map;
		var vectorLayer;
		var features;
		
		function initMap() {
			//Brussels coordinates
			var lat=50.8467493;
			var lon=4.3524950;
			
			//Starting zoom level
			var zoom=11;

			var osm_format;
			
			map = new OpenLayers.Map('map_element', {
				maxResolution: 156543.0399,
			    numZoomLevels: 16,
				units: 'm', //meters
				projection: new OpenLayers.Projection('EPSG:900913'),
				displayProjection: new OpenLayers.Projection('EPSG:4326')});

			var osm_layer = new OpenLayers.Layer.OSM(
				'OpenStreetMap Layer'
			);
			
			var googleStreets = new OpenLayers.Layer.Google(
				"Google Streets",
				{}
			);

			var googleTerrain = new OpenLayers.Layer.Google(
				"Google Terrain",
				{type: google.maps.MapTypeId.TERRAIN}
			);

			var googleHybrid = new OpenLayers.Layer.Google(
				"Google Hybrid",
				{type: google.maps.MapTypeId.HYBRID}
			);

			var googleSatellite = new OpenLayers.Layer.Google(
				"Google Satellite",
				{type: google.maps.MapTypeId.SATELLITE}
			);

			
			osmFormat = new OpenLayers.Format.OSM({
				'internalProjection': new OpenLayers.Projection("EPSG:900913"),
    			'externalProjection': new OpenLayers.Projection("EPSG:4326")
			});
			
			//Initialise the vector layer using OpenLayers.Format.OSM
			vectorLayer = new OpenLayers.Layer.Vector("Vector"); /*new OpenLayers.Layer.Vector("Brussels POIs", {
 				strategies: [new OpenLayers.Strategy.Fixed()],
				protocol: new OpenLayers.Protocol.HTTP({
					url: "brussels_center_filtered.osm",   // relative or absolute URL to the .osm file
					format: osmFormat
					}),
					projection: new OpenLayers.Projection("EPSG:4326")
				});*/
			
			
			
			map.addLayers([googleStreets, googleTerrain, googleHybrid, googleSatellite, osm_layer, vectorLayer]);

			
				
			var selectFeatureControl = new OpenLayers.Control.SelectFeature(
					vectorLayer,
				{
					multiple: false,
					toggle: true,
					multipleKey: 'shiftKey'
				}
			);
			
			map.addControls([selectFeatureControl, new OpenLayers.Control.LayerSwitcher({})]);
			selectFeatureControl.activate();
			
			var lonLat = new OpenLayers.LonLat(lon, lat).transform(new OpenLayers.Projection("EPSG:4326"), new OpenLayers.Projection("EPSG:900913"));
			map.setCenter (lonLat, zoom);
			
			/*
			if(!map.getCenter()){
				map.zoomToMaxExtent();
			}
			*/
		}
	
		function goToCoordinates() {
			var latitude = $('#latitude').val();
			var longitude = $('#longitude').val();
			alert('go to ' + latitude + ' : ' + longitude);
		}
	
		function loadFile() {
			//var osmFile = $('#browse_osm_file_button').val();
			var osmFile = $('#browse_osm_file_button').files[0];
			alert('load file: ' + osmFile);
		}
	
		function populateVectorLayer() {
			var queryString = $('#query_string').val();
			alert('Query string: ' + queryString);
			//cleanVectorLayer();
			/*
			var queryTypeParamName = "queryType";
			var queryStringParamName = "queryString";

			OpenLayers.Request.GET({
			    url: "features_data?"+queryTypeParamName+"="+queryType+"&amp;"+queryStringParamName+"="+queryString,
			    success: function(e) {
			        features = osmFormat.read(e.responseText);
			        vectorLayer.addFeatures(features);
			    }
			});
			*/
		}
	
		function cleanVectorLayer() {
			alert('clean map');
			vectorLayer.destroyFeatures();
		}

		function addListeners() {
			$('div[#options] > #go_button').click(function() {
				goToCoordinates();
			});
			$('div[#options] > #query_button').click(function() {
				populateVectorLayer();
			});
			$('div[#options] > #clear_map_button').click(function() {
				cleanVectorLayer();
			});
			
			
			$('div.help').click(function() {
				$(this).next().toggle('slow');
			});
		}
		
		function disableQueryOptions() {
			$('.query-option').attr('disabled', 'disabled');
		}
		g_disableQueryOptions = disableQueryOptions;
		
		function enableQueryOptions() {
			$('.query-option').removeAttr('disabled');
		}
		g_enableQueryOptions = enableQueryOptions;
		
		$(function() {
			initMap();
			addListeners();
			disableQueryOptions();
		});

	})(jQuery);
	
	</script>


</head>



<body>
	<div id="main" style="position: relative;">
		<div id="left" style="float: left;">
		    <div id="options">
			<!--
				<div>
					<label for="browse_osm_file_button">OSM file</label>
					<input id="browse_osm_file_button" type="file"/>
					<input id="load_osm_file_button" type="button" value="Load selection in logic engine" />
				</div>
			-->
				<div>
					<label for="latitude">Latitude</label>
					<input id="latitude" type="text"/>
					<label for="longitude">Longitude</label>
					<input id="longitude" type="text"/>
					<input id="go_button" type="button" value="Go" />
				</div>
				<div>
					<textarea id="query_string" class="query-option" rows="3" cols="68"></textarea><br />
					<input id="query_button" class="query-option" type="button" value="Query" />
					<input id="clear_map_button" class="query-option" type="button" value="Clear map" />
				</div>
			</div>
			<div id="map_element" style="width: 500px; height: 500px;"></div>
		</div>
		<div id="right" style="float: right;">
			<div class="help"><h1>Help</h1></div>
			<div class="help-content">
				<h2>Logic Variables</h2>
				<p>Node</p>
				<p>Way</p>
				<h2>Logic Predicates</h2>
				<h3>osm/0</h3>
				<p>node/3, node/2, node/1, way/3, way/2, way/1</p>
				<h3>node/3</h3>
				<p>id/1, coordinates/1, distancekm/2, near/2</p>
				<h3>way/3</h3>
				<p>id/1, nodes_ids/1, nodes/1, tags/1, tag/2, near/2, distancekm/2</p>
				<h3>coordinates/2</h3>
				<p>lon/1, lat/1, distancekm/2, distancem/2, near/2</p>
			</div>
		</div>
	</div>

</body>
</html>